<template>
    <div class="comment">
        <div class="comment-item">
            <el-avatar :src="comment.member.avatar" alt="" class="comment-avatar" fit="cover" @click="Open"/>
            <div class="comment-left">
                <div class="comment-header">
                    <div>
                        <span class="user-name">{{ comment.member?.name }}</span>
                        <span v-if="comment.member?.mode > 0" class="blogger">博主</span>
                        <span v-if="parent != null">
                            <span class="user-reply"> 回复 </span>
                            <span class="user-name"> {{ parent.member?.name }} </span>
                            <span v-if="parent.member?.mode > 0" class="blogger">博主</span>
                        </span>
                        <div class="comment-bottom" style="margin-left: auto">
                            <svg class="icon" height="200" p-id="4735" t="1650192965532" version="1.1"
                                 viewBox="0 0 1024 1024" width="200" xmlns="http://www.w3.org/2000/svg"
                                 @click="ReplyComment">
                                <path
                                    d="M819.788835 800.976554l0 158.697395-156.846521-96.562243c-21.750241 3.551896-44.07458 5.628184-67.000649 5.628184-107.742184 0-204.254146-41.231053-270.859782-106.344027 10.971315 0.62831 21.874066 1.421372 33.022421 1.421372 15.629596 0 31.041219-0.765433 46.288082-1.994424 52.58679 36.20355 119.082928 57.953923 191.548256 57.953923 24.974811 0 49.130944-2.841721 72.41109-7.705496l54.486124 36.341696c-0.055261 0.026606-0.108475 0.054235-0.163736 0.081864L763.827042 875.735212l0-43.089377 0-56.041364c84.16015-47.434336 139.903969-129.35102 139.903969-222.63459 0-58.992579-22.515705-113.311719-60.1698-157.413146 2.486736-17.214057 4.208007-34.632775 4.208007-52.435233 0-8.142447-0.873939-16.080234-1.421431-24.099884 69.678751 57.981553 113.343992 139.665946 113.343992 230.449579C959.692804 652.307559 904.823947 742.722802 819.788835 800.976554zM428.057311 700.862415c-22.925045 0-45.263711-2.076288-67.000649-5.629207l-156.845497 96.562243L204.211165 633.126708C119.176053 574.845327 64.307196 484.430084 64.307196 382.593721c0-175.774329 162.857668-318.268694 363.750115-318.268694 200.894494 0 363.750115 142.494365 363.750115 318.268694C791.807427 558.36805 628.951806 700.862415 428.057311 700.862415zM428.057311 120.284527c-169.988357 0-307.789346 119.023814-307.789346 265.806855 0 93.270267 55.743819 175.173648 139.903969 222.63459l0 56.041364 0 43.089377 41.150875-27.241434c-0.068564-0.026606-0.122802-0.055259-0.177039-0.081864l54.513755-36.340673c23.266843 4.863774 47.421952 7.704472 72.397787 7.704472 169.988357 0 307.789346-118.995161 307.789346-265.806855C735.846658 239.307318 598.045669 120.284527 428.057311 120.284527zM609.932881 428.061262c-23.171672 0-41.9716-18.784832-41.9716-41.96988 0-23.170722 18.799928-41.96988 41.9716-41.96988 23.172695 0 41.9716 18.799158 41.9716 41.96988C651.903457 409.275407 633.104552 428.061262 609.932881 428.061262zM442.047504 428.061262c-23.184975 0-41.9716-18.784832-41.9716-41.96988 0-23.170722 18.785602-41.96988 41.9716-41.96988s41.9716 18.799158 41.9716 41.96988C484.019104 409.275407 465.233502 428.061262 442.047504 428.061262zM274.16315 428.061262c-23.184975 0-41.970577-18.784832-41.970577-41.96988 0-23.170722 18.785602-41.96988 41.970577-41.96988s41.9716 18.799158 41.9716 41.96988C316.133727 409.275407 297.348125 428.061262 274.16315 428.061262z"
                                    p-id="4736">
                                </path>
                            </svg>
                            <svg v-if="false" class="icon" height="200" p-id="6249" t="1650193006379" version="1.1"
                                 viewBox="0 0 1024 1024" width="200" xmlns="http://www.w3.org/2000/svg"
                                 @click="ClickLike(true)">
                                <path
                                    d="M190.193225 471.411583c14.446014 0 26.139334-11.718903 26.139334-26.13831 0-14.44499-11.69332-26.164916-26.139334-26.164916-0.271176 0-0.490164 0.149403-0.73678 0.149403l-62.496379 0.146333c-1.425466-0.195451-2.90005-0.295735-4.373611-0.295735-19.677155 0-35.621289 16.141632-35.621289 36.114522L86.622358 888.550075c0 19.949354 15.96767 35.597753 35.670407 35.597753 1.916653 0 3.808746 0.292666 5.649674 0l61.022819 0.022513c0.099261 0 0.148379 0.048095 0.24764 0.048095 0.097214 0 0.146333-0.048095 0.24457-0.048095l0.73678 0 0-0.148379c13.413498-0.540306 24.174586-11.422144 24.174586-24.960485 0-13.55983-10.760065-24.441669-24.174586-24.981974l0-0.393973-50.949392 0 1.450025-402.275993L190.193225 471.409536z"
                                    p-id="6250">
                                </path>
                                <path
                                    d="M926.52241 433.948343c-19.283182-31.445176-47.339168-44.172035-81.289398-45.546336-1.77032-0.246617-3.536546-0.39295-5.380544-0.39295l-205.447139-0.688685c13.462616-39.059598 22.698978-85.58933 22.698978-129.317251 0-28.349675-3.193739-55.962569-9.041934-82.542948l-0.490164 0.049119c-10.638291-46.578852-51.736315-81.31498-100.966553-81.31498-57.264215 0-95.466282 48.15065-95.466282 106.126063 0 3.241834-0.294712 6.387477 0 9.532097-2.996241 108.386546-91.240027 195.548698-196.23636 207.513194l0 54.881958-0.785899 222.227314 0 229.744521 10.709923 0 500.025271 0.222057 8.746198-0.243547c19.35686 0.049119 30.239721-4.817726 47.803749-16.116049 16.682961-10.761088 29.236881-25.50079 37.490869-42.156122 2.260483-3.341095 4.028757-7.075139 5.106298-11.20111l77.018118-344.324116c1.056052-4.053316 1.348718-8.181333 1.056052-12.160971C943.643346 476.446249 938.781618 453.944769 926.52241 433.948343zM893.82573 486.837924l-82.983993 367.783411-0.099261-0.049119c-2.555196 6.141884-6.879688 11.596106-12.872169 15.427364-4.177136 2.727111-8.773827 4.351098-13.414521 4.964058-1.49812-0.195451-3.046383 0-4.620227 0l-477.028511-0.540306-0.171915-407.408897c89.323375-40.266076 154.841577-79.670527 188.596356-173.661202 0.072655 0.024559 0.124843 0.049119 0.195451 0.072655 2.99931-9.137101 6.313799-20.73423 8.697079-33.164331 5.551436-29.185716 5.258771-58.123792 5.258771-58.123792-4.937452-37.98001 25.940812-52.965306 44.364417-52.965306 25.304316 0.860601 50.263777 33.656541 50.263777 52.326762 0 0 5.600555 27.563776 5.649674 57.190537 0.048095 37.366026-4.6673 56.847729-4.6673 56.847729l-0.466628 0c-5.872754 30.879288-16.214287 60.138682-30.464849 86.964654l0.36839 0.342808c-2.358721 4.815679-3.709485 10.220782-3.709485 15.943111 0 19.922748 19.088754 21.742187 38.765909 21.742187l238.761895 0.270153c0 0 14.666024 0.465604 14.690584 0.465604l0 0.100284c12.132318-0.638543 24.221658 5.207605 31.100322 16.409738 5.504364 9.016351 6.437619 19.6045 3.486404 28.988218L893.82573 486.837924z"
                                    p-id="6251">
                                </path>
                                <path
                                    d="M264.827039 924.31872c0.319272 0.024559 0.441045 0.024559 0.295735-0.024559 0.243547-0.048095 0.367367-0.074701-0.295735-0.074701s-0.539282 0.026606-0.271176 0.074701C264.43409 924.343279 264.532327 924.343279 264.827039 924.31872z"
                                    p-id="6252">
                                </path>
                            </svg>
                            <svg v-if="false" class="icon" height="200" p-id="14148" t="1650193414024" version="1.1"
                                 viewBox="0 0 1024 1024" width="200" xmlns="http://www.w3.org/2000/svg"
                                 @click="ClickLike(false)">
                                <path
                                    d="M844.231111 391.39555600000006H659.9111109999999c-13.653333-2.275556-18.204444-15.928889-20.48-22.755556V202.52444400000002c0-45.511111-36.408889-81.92-81.92-81.92-40.96 0-75.093333 31.857778-81.92 70.542223-25.031111 157.013333-120.604444 209.351111-182.044444 225.28 2.275556 6.826667 2.275556 11.377778 2.275555 15.928889v441.457777c0 9.102222-2.275556 18.204444-6.826666 27.306666999999997h446.008888c43.235556-9.102222 72.817778-25.031111 93.297778-68.266667l93.297778-327.68c18.204444-59.16444400000001-11.377778-116.053333-77.368889-113.77777699999999zM257.137778 876.0888889999999V432.355556c0-13.653333-18.204444-25.031111-38.684445-25.031112H157.013333c-31.857778 0-59.16444400000001 27.306666999999997-59.16444400000001 59.16444500000001v373.191111c0 34.133333 25.031111 61.44 59.16444400000001 61.44h61.44c20.48 0 38.684444-11.377778 38.684445-25.031111z m0 0"
                                    fill="#3ad8e7" p-id="14149">
                                </path>
                            </svg>
                        </div>
                    </div>
                    <div>
                        <span>
                            <small style="color: #98a6ad">
                                {{ proxy.functions.GetNearestDate(comment.date) }}
                            </small>
                        </span>
                    </div>
                </div>
                <div :id="contentId" class="comment-main" v-html="props.comment.content"/>
            </div>
        </div>
        <div v-if="areaId === IdHandle" class="comment-editor">
            <editor ref="editor" :reply="true" type="comment" @cancel="CancelComment" @submit="SubmitComment"/>
        </div>
        <div class="comment-reply">
            <slot/>
        </div>
    </div>
</template>

<script setup>
import Editor from "@/components/Editor.vue";
import { getCurrentInstance, inject, ref } from "vue";

let props = defineProps({
    //评论
    comment: {type: Object, default: null},
    //父评论
    parent: {type: Object, default: null},
});
const {areaId, setAreaId} = inject('areaId');
const proxy = getCurrentInstance().proxy;

//内容ID
let contentId = ref(proxy.functions.NewEditorId());
//自身ID
let IdHandle = ref(proxy.functions.NewEditorId());
//点赞
let like = ref(false);
//点赞定时
let likeTime = null;

//打开博客
function Open() {
    let blog = props.comment?.member?.blog ?? '';
    if (blog.trim().length > 0) {
        window.open(blog, '_blank');
    }
}

//回复评论
function ReplyComment() {
    setAreaId(IdHandle);
}

//提交评论
function SubmitComment(editorId) {
    //获取指定 ID 的编辑器实例
    window.commentArea.SubmitComment(editorId, props.comment, props.parent ?? props.comment);
}

//取消评论
function CancelComment() {
    setAreaId('');
}

//点赞
function ClickLike(newLike) {
    like.value = newLike;
    if (likeTime != null) {
        clearTimeout(likeTime);
    }
    likeTime = setTimeout(() => {
    }, 2000);
}

</script>